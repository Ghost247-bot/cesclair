# Netlify Deployment Setup Checklist

## ‚úÖ Pre-Deployment Checklist

### 1. Configuration Files
- [x] `netlify.toml` - Configured with Next.js plugin
- [x] `next.config.ts` - Optimized for Netlify
- [x] `.gitignore` - Includes `.netlify` folder
- [x] `package.json` - Build script configured

### 2. Environment Variables Required

Set these in Netlify Dashboard ‚Üí Site settings ‚Üí Environment variables:

#### Required Variables:
```
DATABASE_URL=postgresql://neondb_owner:npg_Tpxjf7u6DCtH@ep-withered-shadow-a4gnj7n7.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require
```

```
BETTER_AUTH_SECRET=inFvd2NoE+kpwOMYTAhaWiQCb6qnAX7fP/tNaaiNb14=
```

```
NEXT_PUBLIC_SITE_URL=https://your-site-name.netlify.app
```
*(Update after first deployment with actual Netlify URL)*

#### Optional Variables (if using DocuSign):
```
DOCUSIGN_USER_ID=66b17dd5-a43c-4d16-b5b9-3fa96caffad7
DOCUSIGN_ACCOUNT_ID=36e68b88-4496-495f-89ea-161a1aef45b7
DOCUSIGN_BASE_PATH=https://na4.docusign.net
DOCUSIGN_INTEGRATION_KEY=sojm96fffub4/K0fjxafQrXnY1lK3A9TLQ/n5OTWYx0=
DOCUSIGN_PRIVATE_KEY=(your private key)
```

### 3. Build Configuration

- **Build command:** `npm run build` (auto-detected)
- **Node version:** 20 (configured in netlify.toml)
- **Plugin:** `@netlify/plugin-nextjs` (auto-installed)
- **Publish directory:** Handled automatically by plugin

### 4. Database Setup

- [ ] Verify Neon database allows connections from Netlify IPs
- [ ] Test database connection string
- [ ] Ensure database migrations are up to date

### 5. Authentication Setup

- [ ] Generate a secure `BETTER_AUTH_SECRET` for production
- [ ] Update `NEXT_PUBLIC_SITE_URL` after first deployment
- [ ] Verify `trustedOrigins` in `src/lib/auth.ts` includes Netlify URL

## üöÄ Deployment Steps

### Step 1: Connect Repository
1. Go to [Netlify Dashboard](https://app.netlify.com/)
2. Click "Add new site" ‚Üí "Import an existing project"
3. Connect GitHub and select `Ghost247-bot/cesclair`
4. Netlify will auto-detect Next.js configuration

### Step 2: Set Environment Variables
1. Go to Site settings ‚Üí Environment variables
2. Add all required variables (see above)
3. Save changes

### Step 3: Deploy
1. Click "Deploy site"
2. Wait for build to complete (2-5 minutes)
3. Note your Netlify URL

### Step 4: Update Site URL
1. After deployment, update `NEXT_PUBLIC_SITE_URL` with actual Netlify URL
2. Trigger a new deployment to apply changes

### Step 5: Verify
- [ ] Site loads correctly
- [ ] Authentication works (sign up/in)
- [ ] Database connections work
- [ ] API routes function properly
- [ ] Images load correctly

## üîß Build Optimization

### Current Configuration:
- **Node version:** 20
- **Build command:** `npm run build`
- **Plugin:** @netlify/plugin-nextjs
- **Function bundler:** esbuild
- **Image optimization:** Enabled (AVIF, WebP)

### Performance:
- Server-side rendering (SSR) enabled
- Static page generation (SSG) for static pages
- API routes as serverless functions
- Image optimization with Next.js Image component

## üìù Post-Deployment

### Continuous Deployment
- Automatic deploys on push to `main` branch
- Preview deployments for pull requests
- Deploy notifications via email

### Monitoring
- Check build logs in Netlify dashboard
- Monitor function logs for API routes
- Check database connection health
- Monitor error logs

### Updates
1. Make changes locally
2. Commit and push to GitHub
3. Netlify automatically deploys
4. Verify deployment in Netlify dashboard

## üêõ Troubleshooting

### Build Fails
- Check build logs for errors
- Verify all environment variables are set
- Ensure Node version matches (20)
- Check package.json dependencies

### Authentication Issues
- Verify `NEXT_PUBLIC_SITE_URL` matches Netlify URL
- Check `BETTER_AUTH_SECRET` is set
- Verify database connection
- Check trusted origins in auth config

### Database Connection Issues
- Verify `DATABASE_URL` is correct
- Check Neon database allows Netlify connections
- Verify SSL mode in connection string
- Test connection from local environment

### Function Errors
- Check function logs in Netlify dashboard
- Verify environment variables are accessible
- Check function timeout settings
- Verify database connections in functions

## üîí Security

### Headers Configured:
- X-Frame-Options: DENY
- X-XSS-Protection: 1; mode=block
- X-Content-Type-Options: nosniff
- Referrer-Policy: strict-origin-when-cross-origin

### Environment Variables:
- Never commit `.env` files (already in .gitignore)
- Use Netlify environment variables for secrets
- Rotate `BETTER_AUTH_SECRET` regularly
- Use secure database connection strings

## üìö Resources

- [Netlify Documentation](https://docs.netlify.com/)
- [Next.js on Netlify](https://docs.netlify.com/integrations/frameworks/nextjs/)
- [Netlify Plugin Next.js](https://github.com/netlify/netlify-plugin-nextjs)
- [Netlify Support](https://www.netlify.com/support/)

